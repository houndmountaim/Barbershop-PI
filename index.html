<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nine'O Barbershop</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="assets/images/download.png" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
</head>

<body>
  <!-- Navbar Placeholder -->
  <div id="navbar-placeholder"></div>

  <!-- Section -->
  <div id="section-home"></div>
  <div id="section-aboutus"></div>
  <div id="section-teams"></div>
  <div id="section-services"></div>
  <div id="section-products"></div>
  <div id="section-contact"></div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>&copy; 2025 Nine'O Barbershop. All rights reserved.</p>
    </div>
  </footer>

  <!-- Script to Load External HTML Files -->
  <script>
    const sections = {
      "section-home": "frontend/pages/home.html",
      "section-aboutus": "pages/aboutus.html",
      "section-teams": "pages/teams.html",
      "section-services": "pages/services.html",
      "section-products": "pages/products.html",
      "section-contact": "pages/contact.html",
    };

    // Load all sections
    Object.entries(sections).forEach(([id, url]) => {
      fetch(url)
        .then((res) => res.text())
        .then((data) => {
          document.getElementById(id).innerHTML = data;
        })
        .catch((err) => console.error(`Gagal memuat ${url}: `, err));
    });

    // Load Navbar and initialize hamburger menu
    fetch("pages/navbar.html")
      .then((res) => res.text())
      .then((data) => {
        document.getElementById("navbar-placeholder").innerHTML = data;

        // Wait a bit for DOM to be ready, then initialize hamburger menu
        setTimeout(initHamburgerMenu, 100);
      })
      .catch((err) => console.error("Gagal memuat navbar.html: ", err));

    // Function to initialize hamburger menu
    function initHamburgerMenu() {
      const hamburger = document.querySelector(".hamburger-menu");
      const navCenter = document.querySelector(".navbar-center");

      console.log("Initializing hamburger menu...");
      console.log("Hamburger element:", hamburger);
      console.log("NavCenter element:", navCenter);

      if (hamburger && navCenter) {
        const newHamburger = hamburger.cloneNode(true);
        hamburger.parentNode.replaceChild(newHamburger, hamburger);

        newHamburger.addEventListener("click", function (e) {
          e.preventDefault();
          e.stopPropagation();

          console.log("Hamburger clicked!");

          newHamburger.classList.toggle("active");
          navCenter.classList.toggle("active");

          console.log(
            "Hamburger active:",
            newHamburger.classList.contains("active")
          );
          console.log(
            "NavCenter active:",
            navCenter.classList.contains("active")
          );
        });

        const navLinks = document.querySelectorAll(".navbar-center a");
        navLinks.forEach((link) => {
          link.addEventListener("click", function () {
            console.log("Nav link clicked, closing menu");
            newHamburger.classList.remove("active");
            navCenter.classList.remove("active");

            const href = this.getAttribute("href");
            if (href && href.startsWith("#")) {
              const targetId = href.substring(1);
              const targetSection = document.getElementById(
                `section-${targetId}`
              );
              if (targetSection) {
                targetSection.scrollIntoView({
                  behavior: "smooth",
                  block: "start",
                });
              }
            }
          });
        });

        document.addEventListener("click", function (e) {
          if (
            !newHamburger.contains(e.target) &&
            !navCenter.contains(e.target)
          ) {
            newHamburger.classList.remove("active");
            navCenter.classList.remove("active");
          }
        });

        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            newHamburger.classList.remove("active");
            navCenter.classList.remove("active");
          }
        });

        console.log("Hamburger menu initialized successfully!");
      } else {
        console.error(
          "Hamburger menu elements not found. Retrying in 500ms..."
        );
        setTimeout(initHamburgerMenu, 500);
      }
    }

    const observer = new MutationObserver(function (mutations) {
      mutations.forEach(function (mutation) {
        if (mutation.type === "childList") {
          const hamburger = document.querySelector(".hamburger-menu");
          if (hamburger && !hamburger.hasAttribute("data-initialized")) {
            hamburger.setAttribute("data-initialized", "true");
            console.log("Hamburger detected by MutationObserver");
            initHamburgerMenu();
            observer.disconnect();
          }
        }
      });
    });

    observer.observe(document.body, {
      childList: true,
      subtree: true,
    });

    window.addEventListener("load", function () {
      setTimeout(function () {
        if (
          document.querySelector(".hamburger-menu") &&
          !document
            .querySelector(".hamburger-menu")
            .hasAttribute("data-initialized")
        ) {
          console.log("Fallback initialization on window load");
          initHamburgerMenu();
        }
      }, 1000);
    });

    // -----------------------
    // EmailJS Functionality
    // -----------------------
    document.addEventListener("DOMContentLoaded", function () {
      // Load EmailJS script
      const script = document.createElement("script");
      script.src =
        "https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js";
      script.onload = function () {
        emailjs.init("WksM0yjcm2Uq4eME3"); // Public Key

        // Wait for contact section to be loaded
        const observer = new MutationObserver(function () {
          const form = document.querySelector("#section-contact form");
          if (form) {
            observer.disconnect();

            form.addEventListener("submit", function (e) {
              e.preventDefault();

              const data = {
                first_name: form["first-name"].value,
                last_name: form["last-name"].value,
                phone: form["phone"].value,
                email: form["email"].value,
                service: form["service"].value,
                message: form["message"].value,
              };

              emailjs.send("service_uo96cd7", "template_i593pr5", data).then(
                function (response) {
                  console.log(
                    "EmailJS SUCCESS:",
                    response.status,
                    response.text
                  );
                  alert("Message sent successfully!");
                  form.reset();
                },
                function (error) {
                  console.error("EmailJS FAILED:", error);
                  alert("Failed to send message: " + error.text);
                }
              );
            });
          }
        });

        observer.observe(document.getElementById("section-contact"), {
          childList: true,
          subtree: true,
        });
      };
      document.body.appendChild(script);
    });
  </script>
</body>

</html>
